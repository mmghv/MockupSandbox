<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <style>
    html,
    body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <div id="container" style="width: 100%; height: 100%"></div>
  <script src="libs/monaco-editor/min/vs/loader.js"></script>
  <script src="libs/lzma_worker-min.js"></script>
  <script src="code-compress.js"></script>
  <script src="examples.js"></script>
  <script>
    require.config({ paths: { vs: 'libs/monaco-editor/min/vs' } });

    require(['vs/editor/editor.main'], function () {
      editor = monaco.editor.create(document.getElementById('container'), {
        value: code,
        language: 'javascript',
        theme: "vs-dark",
        automaticLayout: true,
        // scrollBeyondLastLine: false,
        fontSize: 18,
      });

      editor.onDidChangeModelContent(() => {
        clearTimeout(window.timeoutId);
        window.timeoutId = setTimeout(() => {
          run(true);
        }, 500);
      });

      fetch('ui-controls.d.ts')
        .then(r => r.text())
        .then(r => {
          monaco.languages.typescript.javascriptDefaults.addExtraLib(r, "ts:filename/ui-controls.d.ts");
        })

      run(false);
    });

    function run(save) {
      parent.window.postMessage({type: 'run', code: editor.getValue(), save}, "*")
    }
  </script>
</body>

</html>